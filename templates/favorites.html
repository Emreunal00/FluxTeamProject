<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favori Filmler</title>
    <link rel="stylesheet" href="../frontend/styles_favorites.css">
</head>
<body>

    <!-- Navbar -->
    <div class="navbar">
        <a href="/dashboard" class="flux-btn">FLUX</a> <!-- FLUX butonu -->
        <div class="profile-container">
            <button class="profile-btn">Profil</button>
            <div class="dropdown-menu">
                <a href="/profile" class="dropdown-item">Profili Düzenle</a>
                <a href="/favorites" class="dropdown-item">Favoriler</a>
                <a href="/watched" class="dropdown-item">İzlediklerim</a>
            </div>
        </div>
        <a href="/logout" class="logout-btn">Çıkış Yap</a>
    </div>
    
    <!-- Favori Filmler Container -->
    <div class="dashboard-container">
        <h2 style="text-align: center;">Favori Filmleriniz</h2>
        <div class="movie-container">
            {% for movie in favorite_movies %}
                <div class="movie-card" data-title="{{ movie.title }}">
                    <img src="{{ movie.poster or 'https://via.placeholder.com/300x450?text=No+Image' }}" alt="Film Posteri">
                    <h3>{{ movie.title }}</h3>
                    <p>{{ movie.year or 'Bilinmiyor' }}</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <div id="movie-popup" class="movie-popup" style="display: none;">
        <div class="popup-content">
            <span id="close-popup" class="close-popup">&times;</span>
            <img id="popup-poster" src="" alt="Film Posteri">
            <h3 id="popup-title"></h3>
            <p id="popup-plot"><strong>Konu:</strong> </p>
            <p id="popup-year"><strong>Yıl:</strong> </p>
            <p id="popup-genre"><strong>Tür:</strong> </p>
            <p id="popup-director"><strong>Yönetmen:</strong> </p>
            <p id="popup-actors"><strong>Oyuncular:</strong> </p>
            <p id="popup-imdb"><strong>IMDb Puanı:</strong> </p>
            <button id="remove-from-favorites" class="btn btn-primary">Favorilerden Çıkar</button>
        </div>
    </div>

    <script>
        const movieCards = document.querySelectorAll('.movie-card');
        const moviePopup = document.getElementById('movie-popup');
        const closePopup = document.getElementById('close-popup');
        const popupPoster = document.getElementById('popup-poster');
        const popupTitle = document.getElementById('popup-title');
        const popupPlot = document.getElementById('popup-plot');
        const popupYear = document.getElementById('popup-year');
        const popupGenre = document.getElementById('popup-genre');
        const popupDirector = document.getElementById('popup-director');
        const popupActors = document.getElementById('popup-actors');
        const popupImdb = document.getElementById('popup-imdb');
        const removeFromFavorites = document.getElementById('remove-from-favorites');

        let currentTitle = '';

        movieCards.forEach(card => {
            card.addEventListener('click', () => {
                const title = card.getAttribute('data-title');
                currentTitle = title;
                fetch(`/movie_details?title=${title}`)
                    .then(response => response.json())
                    .then(data => {
                        popupTitle.textContent = data.Title;
                        popupPoster.src = data.Poster;
                        popupPlot.innerHTML = `<strong>Konu:</strong> ${data.Plot}`;
                        popupYear.innerHTML = `<strong>Yıl:</strong> ${data.Year}`;
                        popupGenre.innerHTML = `<strong>Tür:</strong> ${data.Genre}`;
                        popupDirector.innerHTML = `<strong>Yönetmen:</strong> ${data.Director}`;
                        popupActors.innerHTML = `<strong>Oyuncular:</strong> ${data.Actors}`;
                        popupImdb.innerHTML = `<strong>IMDb Puanı:</strong> ${data.imdbRating}`;

                        moviePopup.style.display = 'block';
                    });
            });
        });

        closePopup.addEventListener('click', () => {
            moviePopup.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === moviePopup) {
                moviePopup.style.display = 'none';
            }
        });

        removeFromFavorites.addEventListener('click', () => {
            fetch('/remove_from_favorites', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: currentTitle })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    document.querySelector(`.movie-card[data-title="${currentTitle}"]`).remove();
                    moviePopup.style.display = 'none';
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                alert('Favorilerden çıkarılırken bir hata oluştu.');
                console.error('Error:', error);
            });
        });
    </script>

</body>
</html>
