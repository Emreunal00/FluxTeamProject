<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLUX</title>
    <!-- CSS Bağlantısı -->
    <link rel="stylesheet" href="../frontend/styles_dashboard.css">
</head>
<body>

    <!-- Navbar -->
    <div class="navbar">
        <a href="/dashboard" class="flux-btn">FLUX</a>
        <div class="profile-container">
            <button class="profile-btn">Profil</button>
            <div class="dropdown-menu">
                <a href="/profile" class="dropdown-item">Profili Düzenle</a>
                <a href="/favorites" class="dropdown-item">Favoriler</a>
                <a href="/watched" class="dropdown-item">İzlediklerim</a>
                <a href="/watchlist" class="dropdown-item">İzleme Listesi</a>
                <a href="/ratings" class="dropdown-item">Puanlarım</a>
            </div>
        </div>
        <a href="/logout" class="logout-btn">Çıkış Yap</a>
    </div>
    
    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <h2 style="text-align: center;">Flux Movie Database</h2>
        <!-- Arama Formu -->
        <div class="button-container">
            <form method="POST" action="/movies" class="mb-4">
                <div class="input-group">
                    <input 
                        type="text" 
                        name="movie_name" 
                        class="form-control" 
                        placeholder="Film adını giriniz..." 
                        required>
                    <button type="submit" class="btn btn-primary">Ara</button>
                </div>
            </form>
        </div>

        <!-- Film Önerileri -->
        <div class="recommendations-container">
            <h3>İlginizi Çekebilir</h3>
            <!-- Film Kartları Konteyneri -->
            <div class="movie-container">
                {% for movie in recommended_movies %}
                    <div class="movie-card" data-title="{{ movie.title }}">
                        <img src="{{ movie.poster }}" alt="Film Posteri">
                        <h3>{{ movie.title }}</h3>
                        <p>{{ movie.year }}</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div id="movie-popup" class="movie-popup" style="display: none;">
        <div class="popup-content">
            <span id="close-popup" class="close-popup">&times;</span>
            <img id="popup-poster" src="" alt="Film Posteri">
            <h3 id="popup-title"></h3>
            <p id="popup-plot"><strong>Konu:</strong> </p>
            <p id="popup-year"><strong>Yıl:</strong> </p>
            <p id="popup-genre"><strong>Tür:</strong> </p>
            <p id="popup-director"><strong>Yönetmen:</strong> </p>
            <p id="popup-actors"><strong>Oyuncular:</strong> </p>
            <p id="popup-imdb"><strong>IMDb Puanı:</strong> </p>
            <button id="add-to-favorites" class="btn btn-primary">Favorilere Ekle</button>
            <button id="add-to-watched" class="btn btn-primary">İzlenenlere Ekle</button>
            <button id="add-to-watchlist" class="btn btn-primary">İzleme Listesine Ekle</button>
        </div>
    </div>

    <script>
        const movieCards = document.querySelectorAll('.movie-card');
        const moviePopup = document.getElementById('movie-popup');
        const closePopup = document.getElementById('close-popup');
        const popupPoster = document.getElementById('popup-poster');
        const popupTitle = document.getElementById('popup-title');
        const popupPlot = document.getElementById('popup-plot');
        const popupYear = document.getElementById('popup-year');
        const popupGenre = document.getElementById('popup-genre');
        const popupDirector = document.getElementById('popup-director');
        const popupActors = document.getElementById('popup-actors');
        const popupImdb = document.getElementById('popup-imdb');
        const addToFavorites = document.getElementById('add-to-favorites');
        const addToWatched = document.getElementById('add-to-watched');
        const addToWatchlist = document.getElementById('add-to-watchlist');

        let currentMovieData = {};

        movieCards.forEach(card => {
            card.addEventListener('click', () => {
                const title = card.getAttribute('data-title');
                fetch(`/movie_details?title=${title}`)
                    .then(response => response.json())
                    .then(data => {
                        currentMovieData = data;
                        popupTitle.textContent = data.Title;
                        popupPoster.src = data.Poster;
                        popupPlot.innerHTML = `<strong>Konu:</strong> ${data.Plot}`;
                        popupYear.innerHTML = `<strong>Yıl:</strong> ${data.Year}`;
                        popupGenre.innerHTML = `<strong>Tür:</strong> ${data.Genre}`;
                        popupDirector.innerHTML = `<strong>Yönetmen:</strong> ${data.Director}`;
                        popupActors.innerHTML = `<strong>Oyuncular:</strong> ${data.Actors}`;
                        popupImdb.innerHTML = `<strong>IMDb Puanı:</strong> ${data.imdbRating}`;

                        moviePopup.style.display = 'block';
                    });
            });
        });

        closePopup.addEventListener('click', () => {
            moviePopup.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === moviePopup) {
                moviePopup.style.display = 'none';
            }
        });

        addToFavorites.addEventListener('click', () => {
            fetch('/add_to_favorites', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ movie_data: JSON.stringify(currentMovieData) })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                alert('Favorilere eklenirken bir hata oluştu.');
                console.error('Error:', error);
            });
        });

        addToWatched.addEventListener('click', () => {
            fetch('/add_to_watched', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ movie_data: JSON.stringify(currentMovieData) })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                alert('İzlenenlere eklenirken bir hata oluştu.');
                console.error('Error:', error);
            });
        });

        addToWatchlist.addEventListener('click', () => {
            fetch('/add_to_watchlist', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ movie_data: JSON.stringify(currentMovieData) })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                alert('İzleme listesine eklenirken bir hata oluştu.');
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
